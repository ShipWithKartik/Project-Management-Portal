<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Quick Notes - UniDesk</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Notes Specific Styles */
    .notes-header {
      background: #fff;
      padding: var(--spacing-lg) 20px;
      border-bottom: 2px solid var(--accent-quaternary);
      /* Deep Red Border */
      margin-bottom: var(--spacing-md);
    }

    .page-title {
      color: var(--accent-quaternary);
    }

    .notes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--spacing-md);
      padding: 0 20px var(--spacing-xl);
      max-width: 1400px;
      margin: 0 auto;
    }

    .note-card {
      background: #fff;
      border: 1px solid var(--border-color);
      padding: var(--spacing-md);
      border-radius: 4px;
      /* Slightly sharper corners for notes */
      position: relative;
      transition: var(--transition-smooth);
    }

    .note-card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-3px);
    }

    .note-card.voice {
      border-left: 4px solid #f59e0b;
    }

    .note-card.text {
      border-left: 4px solid var(--accent-quaternary);
    }

    .note-date {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .note-content {
      font-family: var(--font-body);
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text-primary);
      max-height: 150px;
      overflow: hidden;
    }

    /* Modal & Recorder Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-box {
      background: #fff;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      border-top: 5px solid var(--accent-quaternary);
    }

    .mic-btn-large {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--accent-quaternary);
      color: white;
      font-size: 2rem;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 20px auto;
      box-shadow: 0 5px 15px rgba(102, 34, 34, 0.3);
      transition: transform 0.2s;
    }

    .mic-btn-large:hover {
      transform: scale(1.1);
    }

    .mic-btn-large.recording {
      animation: pulse 1.5s infinite;
      background: #dc2626;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4);
      }

      70% {
        box-shadow: 0 0 0 20px rgba(220, 38, 38, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
      }
    }
  </style>
</head>

<body>
  <!-- Global Header -->
  <header class="global-header">
    <div class="header-container">
      <div class="brand-logo" onclick="window.location.href='dashboard.html'">UniDesk</div>

      <nav class="header-nav">
        <div class="hamburger" id="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>

        <ul class="nav-links" id="navLinks">
          <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
          <li><a href="#" class="nav-link">Reports</a></li>
          <li><a href="outlook-calendar.html" class="nav-link">Calendar</a></li>
          <li><a href="aboutus.html" class="nav-link">About Us</a></li>
        </ul>

        <div class="profile-container">
          <div class="profile-icon" id="profileIcon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <div class="profile-dropdown" id="profileDropdown">
            <a href="profile.html" class="dropdown-item">View Profile</a>
            <a href="#" class="dropdown-item" id="dropdownLogoutBtn">Logout</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <div class="notes-header">
    <div class="container" style="max-width:1400px; padding:0;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1 class="page-title" style="font-family:var(--font-heading); font-size:2.5rem;">Quick Notes</h1>
        <div style="display:flex; gap:10px;">
          <button class="btn" onclick="openTextModal()" style="background:var(--accent-quaternary);">+ Text
            Note</button>
          <button class="btn" onclick="openVoiceModal()" style="background:#f59e0b;">üé§ Voice Note</button>
        </div>
      </div>
    </div>
  </div>

  <div class="container" style="max-width:1400px; padding:0 20px; margin-bottom:20px;">
    <select id="typeFilter" onchange="applyFilters()" style="padding:8px; border:1px solid var(--border-color);">
      <option value="all">All Notes</option>
      <option value="text">Text Only</option>
      <option value="voice">Voice Notes</option>
    </select>
  </div>

  <div class="notes-grid" id="notesGrid">
    <!-- Generated by JS -->
  </div>

  <!-- Text Modal -->
  <div class="modal-overlay" id="textModal">
    <div class="modal-box">
      <h2 style="font-family:var(--font-heading); margin-bottom:15px;">New Note</h2>
      <textarea id="noteContent"
        style="width:100%; height:150px; padding:10px; border:1px solid var(--border-color); margin-bottom:15px; font-family:var(--font-body);"></textarea>
      <div style="display:flex; justify-content:flex-end; gap:10px;">
        <button class="btn-outline" onclick="closeModals()">Cancel</button>
        <button class="btn" onclick="saveTextNote()" style="background:var(--accent-quaternary);">Save</button>
      </div>
    </div>
  </div>

  <!-- Voice Modal -->
  <div class="modal-overlay" id="voiceModal">
    <div class="modal-box" style="text-align:center;">
      <h2 style="font-family:var(--font-heading);">Voice Note</h2>
      <button class="mic-btn-large" id="recordBtn" onclick="toggleRecording()">üé§</button>
      <p id="recStatus" style="color:var(--text-secondary);">Tap to Record</p>
      <button class="btn-outline" onclick="closeModals()" style="margin-top:20px;">Close</button>
    </div>
  </div>

  <script>
    // Header Interactions
    const profileIcon = document.getElementById('profileIcon');
    const profileDropdown = document.getElementById('profileDropdown');
    const hamburger = document.getElementById('hamburger');
    const navLinks = document.getElementById('navLinks');

    if (profileIcon) {
      profileIcon.addEventListener('click', (e) => {
        e.stopPropagation();
        profileDropdown.classList.toggle('show');
      });
    }

    document.addEventListener('click', (e) => {
      if (profileDropdown && !profileDropdown.contains(e.target) && e.target !== profileIcon) {
        profileDropdown.classList.remove('show');
      }
    });

    if (hamburger) {
      hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        navLinks.classList.toggle('mobile-active');
      });
    }

    const handleLogout = (e) => {
      e.preventDefault();
      sessionStorage.removeItem("userEmail");
      sessionStorage.removeItem("isLoggedIn");
      window.location.href = "index.html";
    };

    const dropdownLogoutBtn = document.getElementById("dropdownLogoutBtn");
    if (dropdownLogoutBtn) dropdownLogoutBtn.onclick = handleLogout;

    // Notes Page Script
    const API_BASE = window.location.origin;
    const user_email = sessionStorage.getItem('userEmail');
    if (!user_email) window.location.href = 'index.html';

    let allNotes = [];
    let isRecording = false;

    document.addEventListener('DOMContentLoaded', loadNotes);

    async function loadNotes() {
      try {
        const res = await fetch(`${API_BASE}/notes/${encodeURIComponent(user_email)}`);
        if (res.ok) {
          const data = await res.json();
          allNotes = Array.isArray(data) ? data : [];
          renderNotes(allNotes);
        }
      } catch (e) { console.error(e); }
    }

    function renderNotes(notes) {
      const grid = document.getElementById('notesGrid');
      if (!notes.length) {
        grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:var(--text-secondary); padding:50px;"><h3>No notes yet</h3></div>`;
        return;
      }

      grid.innerHTML = notes.map(note => `
    <div class="note-card text">
      <div class="note-date">${new Date(note.created_date).toLocaleDateString()}</div>
      <div class="note-content">
        <strong style="display:block; margin-bottom:8px; color:var(--accent-quaternary);">${note.title || 'Untitled'}</strong>
        ${note.content}
      </div>
      <div style="margin-top:10px; display:flex; justify-content:flex-end;">
        <button onclick="deleteNote(${note.id})" style="background:none; border:none; color:var(--text-secondary); cursor:pointer; font-size:1.2rem;">üóëÔ∏è</button>
      </div>
    </div>
  `).join('');
    }

    function applyFilters() {
      const type = document.getElementById('typeFilter').value;
      const filtered = type === 'all' ? allNotes : allNotes.filter(n => n.type === type);
      renderNotes(filtered);
    }

    // --- Modal & Actions ---
    function closeModals() {
      document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
    }
    function openTextModal() { document.getElementById('textModal').classList.add('active'); }
    function openVoiceModal() { document.getElementById('voiceModal').classList.add('active'); }

    async function saveTextNote() {
      const text = document.getElementById('noteContent').value;
      if (!text.trim()) return;

      try {
        const res = await fetch(`${API_BASE}/notes`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_email: user_email,
            title: 'Quick Note',
            content: text,
            created_date: new Date().toISOString()
          })
        });

        if (!res.ok) {
          alert('Error saving note');
          return;
        }

        document.getElementById('noteContent').value = '';
        closeModals();
        await loadNotes();
      } catch (e) {
        console.error('Error saving note:', e);
        alert('Error saving note');
      }
    }

    async function toggleRecording() {
      const btn = document.getElementById('recordBtn');
      const status = document.getElementById('recStatus');

      // Mock Recording Logic for UI Demo
      if (!isRecording) {
        isRecording = true;
        btn.classList.add('recording');
        status.textContent = 'Recording... (Mock)';
      } else {
        isRecording = false;
        btn.classList.remove('recording');
        status.textContent = 'Saving...';

        // Auto-save mock voice note
        try {
          await fetch(`${API_BASE}/notes`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_email, type: 'voice', content: 'Voice Note' })
          });
          closeModals();
          loadNotes();
        } catch (e) { alert('Error saving voice note'); }

        status.textContent = 'Tap to Record';
      }
    }

    async function deleteNote(id) {
      if (!confirm('Delete note?')) return;
      try {
        await fetch(`${API_BASE}/notes/${id}`, { method: 'DELETE' });
        loadNotes();
      } catch (e) { }
    }

  </script>
</body>

</html>